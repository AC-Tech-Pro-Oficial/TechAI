---
description: Semantic sync - analyzes changes & context to update rules, then pushes to GitHub
matches: "^/sync"
---
// turbo-all

# Context-Aware Sync Workflow v4.1 (Safe Mode)

> **Source**: `%USERPROFILE%\.gemini\antigravity\global_workflows\`
> **Config**: `D:\TechAI\projects.json`
> **Goal**: Sync projects & Generate READMEs autonomously (Non-destructive).

## Command Variants
- `/sync` (Full)
- `/sync dry-run` (Visualize)
- `/sync quick` (Skip analysis)

---

## Phase 1: Discovery & Analysis
// turbo
```powershell
[Console]::OutputEncoding=[System.Text.Encoding]::UTF8; Write-Host "üîß Sync v4.1..."
$dryRun=$args -contains "dry-run"; $quick=$args -contains "quick"
if(!(Test-Connection github.com -count 1 -q)){Write-Host "‚ùå No Internet";exit 1}

$projects=@(); $conf=(Get-Content "D:\TechAI\projects.json" -Raw|ConvertFrom-Json)
foreach($p in $conf.autoDiscover.scanPaths){
    if(!(Test-Path $p)){continue}
    Get-ChildItem $p -Dir -Recurse -Depth $conf.autoDiscover.maxDepth -Force -ErrorAction SilentlyContinue|Where{$_.Name -eq ".git"}|ForEach{
        $d=$_.Parent; $t="Unknown"; if($d.Name -eq "TechAI"){$t="Hub"}elseif(Test-Path "$($d.FullName)\pubspec.yaml"){$t="Flutter"}
        $projects+=@{Name=$d.Name;Path=$d.FullName;Type=$t}
    }
}
Write-Host "üì¶ Found $($projects.Count) projects"
$projects|ConvertTo-Json|Set-Content "D:\TechAI\.sync_projects_tmpy.json"
```

## Phase 2: Agent Drafting (Safe READMEs)
*   **Agent**: `TechRules`
*   **Action**: Generate `README.md` ONLY if missing or previously auto-generated.

// turbo
```powershell
$projs=Get-Content "D:\TechAI\.sync_projects_tmpy.json"|ConvertFrom-Json
foreach($p in $projs){
    $path = "$($p.Path)\README.md"
    $shouldWrite = $true
    
    if(Test-Path $path){
        $content = Get-Content $path -Raw
        # Only overwrite if it contains the auto-generation signature
        if($content -notmatch "\*Generated by TechAI\*"){ $shouldWrite = $false }
    }
    
    if($shouldWrite){
        $doc="See documentation."; if($p.Type -eq "Flutter"){$doc="flutter run"}
        $readme="# $($p.Name)`n`n> A $($p.Type) project.`n`n## Start`n`n$doc`n`n*Generated by TechAI*";
        Set-Content $path $readme -Encoding UTF8
        Write-Host "üìù Updated README for $($p.Name)"
    } else {
        Write-Host "‚è≠Ô∏è Skipped custom README for $($p.Name)"
    }
}
```

## Phase 3: Execution & Sync
> **Check before proceeding.** If `$dryRun`, Agent MUST stop here.

// turbo
```powershell
$projs=Get-Content "D:\TechAI\.sync_projects_tmpy.json" -Raw|ConvertFrom-Json
$dryRun=$args -contains "dry-run"

if($dryRun){ Write-Host "Dry run completed."; exit 0 }

# 1. SYNC WORKFLOWS (Global -> Local)
$src="$env:USERPROFILE\.gemini\antigravity\global_workflows"
@("D:\TechAI\.agent\workflows","D:\.agent\workflows")|ForEach{
    if(!(Test-Path $_)){New-Item $_ -ItemType Dir -Force|Out-Null}
    Copy-Item "$src\*.md" "$_\" -Force
}

# 2. GIT SYNC
foreach($p in $projs){
    Push-Location $p.Path
    Write-Host "Syncing $($p.Name)..."
    
    # Drag latest changes first
    git pull --rebase | Out-Null
    
    if(git status --porcelain){
        git add -A
        git commit -m "üîÑ Sync v4.1"
        git push
        if($LASTEXITCODE -eq 0){
            Write-Host "‚úÖ Synced $($p.Name)"
        } else {
            Write-Host "‚ùå Failed to push $($p.Name)"
        }
        Start-Sleep -s 5
    } else {
         Write-Host "‚ú® Clean"
    }
    Pop-Location
}
Remove-Item "D:\TechAI\.sync_projects_tmpy.json" -ErrorAction SilentlyContinue
```
